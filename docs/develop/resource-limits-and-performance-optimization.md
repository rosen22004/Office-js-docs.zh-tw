
# Office 增益集的資源限制和效能最佳化



若要為您的使用者創造最佳的體驗，請確定 Office 增益集在 CPU 核心和記憶體使用量的特定限制內執行、可靠性，以及，針對 Outlook 增益集，用於評估規則運算式的回應時間。這些執行階段的資源使用量限制會適用於 Windows 和 OS X 的 Office 用戶端上執行的增益集，但不適用 Office Online、Outlook Web App 或 OWA for Devices。您也可以最佳化您的增益集設計和實作中資源的使用，以最佳化您的增益集在桌面和行動裝置上的效能。

## 增益集的資源使用量限制


執行階段的資源使用量限制適用於所有類型的 Office 增益集。這些限制有助於確保您的使用者的效能，並減少拒絕服務攻擊。請務必在您的目標主應用程式上使用可能的資料範圍測試 Office 增益集，並對下列執行階段使用量限制衡量效能︰


-  **CPU 核心使用量** - 90% 的單一 CPU 核心使用量臨界值，在預設的 5 秒間隔中觀察到三次。
    
    主豐富型用戶端檢查 CPU 核心使用量的預設間隔為每 5 秒一次。 如果主用戶端偵測到增益集的 CPU 核心使用量的超出臨界值，它會顯示訊息，詢問使用者是否要繼續執行增益集。 如果使用者選擇要繼續，則在該編輯工作階段期間，主用戶端不會再詢問使用者。 如果使用者執行需要大量 CPU 的增益集，系統管理員可能想要使用 **AlertInterval** 登錄機碼，以提高臨界值來減少這項警告訊息的顯示機率。
    
-  **記憶體使用量** - 根據裝置上的可用實體記憶體，動態決定的預設記憶體使用量臨界值。
    
    根據預設，當主豐富型用戶端偵測到裝置上的實體記憶體使用量佔超過 80% 的可用記憶體，則用戶端開始監視增益集的記憶體使用量，包含文件層級的內容和工作窗格增益集，以及信箱層級的 Outlook 增益集。 在 5 秒的預設間隔內，如果在文件或信箱層級的一組增益集的實體記憶體使用量超過 50%，用戶端會警告使用者。 這個記憶體使用量限制控管實體而不是虛擬記憶體的使用量，以確保 RAM 容量有限的裝置效能。 系統管理員可以使用 **MemoryAlertThreshold** Windows 登錄機碼做為全域設定，利用明確限制覆寫此動態設定，或使用 **AlertInterval** 機碼做為全域設定，調整警示間隔。
    
-  **損毀容許度** - 增益集有四個損毀的預設限制。
    
    系統管理員可以使用 **RestartManagerRetryLimit** 登錄機碼來調整損毀的臨界值。
    
-  **應用程式封鎖** - 增益集的未回應臨界值延長為 5 秒。
    
    這會影響增益集和主應用程式的使用者體驗。 在這種情況下，主應用程式會自動重新啟動所有使用中的文件或信箱增益集 (如果適用)，並警告使用者哪些增益集沒有回應。 若增益集執行長時間工作時沒有定期釋出處理資源，則增益集可能達到此臨界值。 有一些技巧可確保不要發生中斷的問題。 系統管理員無法覆寫這個臨界值。
    
     **Outlook 增益集**
    
    如果任何 Outlook 增益集超過上述的 CPU 核心或記憶體使用量臨界值，或當機的容忍度限制，Outlook 會停用增益集。 Exchange 系統管理中心會顯示應用程式的停用狀態。
    
     >**附註**  即使只有 Outlook 豐富型用戶端監視資源使用量，而 Outlook Web App 或裝置用 OWA 未監視，如果豐富型用戶端停用 Outlook 增益集，則 Outlook Web App 和裝置用 OWA 中也會停用該增益集。

    除了 CPU 核心、記憶體及可靠性規則，Outlook 增益集啟動時應遵守下列規則︰
    
      -  **規則運算式回應時間** - 預設閾值為 1,000 毫秒，讓 Outlook 評估 Outlook 增益集的資訊清單中的所有規則運算式。超過閾值會導致 Outlook 稍後重試評估。
    
        使用群組原則或 Windows 登錄中的應用程式特定設定，系統管理員可以調整此 **OutlookActivationAlertThreshold** 設定中的預設臨界值 1,000 毫秒。 如需詳細資訊，請參閱[覆寫 Office 增益集效能的資源使用量設定](http://msdn.microsoft.com/library/da14ec8c-5075-4035-a951-fc3c2b15c04b%28Office.15%29.aspx)。
    
  -  **規則運算式重新評估** - 預設上限為三次，讓 Outlook 重新評估資訊清單中的所有規則運算式。如果這三次評估因超過適用的閾值 (預設值 1,000 毫秒或 **OutlookActivationAlertThreshold** 指定的值，如果 Windows 登錄存在該設定) 而失敗，Outlook 會停用 Outlook 增益集。Exchange 系統管理中心顯示已停用的狀態，並且增益集對於在 Outlook 豐富型用戶端、Outlook Web App 和 OWA for Devices 中使用已停用。
    
    使用群組原則或 Windows 登錄中的應用程式特定設定，系統管理員可以調整此 **OutlookActivationManagerRetryLimit** 設定中的重試評估次數。 如需詳細資訊，請參閱[覆寫 Office 增益集效能的資源使用量設定](http://msdn.microsoft.com/library/da14ec8c-5075-4035-a951-fc3c2b15c04b%28Office.15%29.aspx)。
    

    **工作窗格和內容增益集**
    
    如果有任何內容或工作窗格增益集超過先前的 CPU 核心或記憶體使用量的臨界值，或當機的容忍度限制，對應的主應用程式會對使用者顯示警告。 這個時候使用者可以執行下列其中一個動作：
    
  - 重新啟動增益集。
    
  - 取消有關超過該閾值的進一步警示。在理想的情況下，使用者應該接著從文件中刪除該增益集；繼續使用增益集可能會進一步造成效能和穩定性問題。
    

## 驗證遙測記錄記錄中的資源使用量問題


Office 提供的遙測記錄，可維護本機電腦上執行的 Office 方案特定事件的記錄 (載入、開啟、關閉和錯誤)，包括 Office 增益集中的資源使用量問題。如果您已設定遙測記錄，您可以使用 Excel，在您的本機磁碟機上的下列預設位置開啟遙測記錄︰

%Users%\ \<lt;目前的使用者 \>gt; \AppData\Local\Microsoft\Office\15.0\Telemetry

針對遙測記錄對增益集追蹤的每個事件，會有生次數的日期/時間、事件識別碼、嚴重性，以及事件的簡短描述性標題、好記的名稱和增益集的唯一識別碼，以及記錄事件的應用程式。您可以重新整理遙測記錄，以查看目前追蹤的事件。下表顯示已在遙測記錄中追蹤的 Outlook 增益集的範例。 



|**日期/時間**|**事件識別碼**|**Severity**|**標題**|**File**|**識別碼**|**應用程式**|
|:-----|:-----|:-----|:-----|:-----|:-----|:-----|
|10/8/2012 5:57:10 PM|7||增益集資訊清單已順利下載|對象|69cc567c-6737-4c49-88dd-123334943a22|Outlook|
|10/8/2012 5:57:01 PM|7||增益集資訊清單已順利下載|LinkedIn|333bf46d-7dad-4f2b-8cf4-c19ddc78b723|Outlook|
 下表列出遙測記錄一般會追蹤 Office 增益集的事件。



|**事件識別碼**|**標題**|**Severity**|**說明**|
|:-----|:-----|:-----|:-----|
|7|增益集資訊清單已順利下載||Office 增益集的資訊清單已成功載入，且由主應用程式讀取。|
|8|增益集資訊清單未下載|重大|主應用程式無法從 SharePoint 目錄、公司的目錄中或 Office 市集載入 Office 增益集的資訊清單檔案。|
|9|無法剖析增益集標記|重大|主應用程式會載入 Office 增益集資訊清單，但無法讀取應用程式的 HTML 標記。|
|10|增益集使用太多 CPU|重大|Office 增益集在一段有限的時間使用超過 90%的 CPU 資源。|
|15|因為字串搜尋逾時，增益集已停用||Outlook 增益集可搜尋電子郵件的主旨行和訊息，以判斷是否應該使用規則運算式顯示它們。**檔案**欄列出的 Outlook 增益集已被 Outlook 停用，因為它在嘗試比對規則運算式時重複逾時。|
|18|增益集已成功關閉||主應用程式已成功關閉 Office 增益集。|
|19|增益集發生執行階段錯誤|重要|Office 增益集有造成失敗的問題。如需詳細資訊，請在遇到錯誤的電腦上使用 Windows 事件檢視器查看 **Microsoft Office 警示**記錄。|
|20|增益集無法驗證授權|重要|Office 增益集的授權資訊無法驗證，且可能已經過期。如需詳細資訊，請在遇到錯誤的電腦上使用 Windows 事件檢視器查看 **Microsoft Office 警示**記錄。|
如需詳細資訊，請參閱[部署遙測儀表板](http://msdn.microsoft.com/en-us/library/f69cde72-689d-421f-99b8-c51676c77717%28Office.15%29.aspx)和 [使用遙測記錄進行 Office 檔案及自訂解決方案的疑難排解](http://msdn.microsoft.com/library/ef88e30e-7537-488e-bc72-8da29810f7aa%28Office.15%29.aspx)


## 設計和實作技術


雖然對 CPU 和記憶體使用量、損毀容許度、UI 回應性的限制僅會套用到在豐富的用戶端上執行的 Office 增益集，如果您希望增益集能夠在所有支援的用戶端與裝置上順暢執行，應優先將這些資源和電池使用量最佳化。如果您的增益集會執行長時間執行的作業或處理大型資料集，最佳化尤其重要。下列清單建議一些技術來將需要大量的 CPU 或耗用大量資料的作業分割成較小的區塊，使增益集可以避免過多的資源消耗，而主應用程式仍然可以正常回應︰


- 在增益集需要從未繫結的資料集讀取大量資料的案例中，從資料表中讀取資料時，您可以套用分頁，或減少每一個較短的讀取作業中資料的大小，而非嘗試在單一作業中完成讀取。 
    
    針對 JavaScript 和 jQuery 程式碼範例，其中顯示可能為未繫結資料上長時間執行和需要大量 CPU 的輸入和輸出作業系列發生中斷，請參閱[如何在大量 JavaScript 處理時讓瀏覽器重獲控制權？](http://stackoverflow.com/questions/210821/how-can-i-give-control-back-briefly-to-the-browser-during-intensive-javascript) 此範例使用全域物件的 [setTimeout](http://msdn.microsoft.com/en-us/library/ie/ms536753%28v=vs.85%29.aspx) 方法，限制輸入和輸出的期間。 它也會處理的定義區塊中的資料，而不是隨機的未繫結資料。
    
- 如果增益集使用需要大量 CPU 的演算法來處理大量資料，您可以使用 Web 背景工作在背景處理長時間執行的工作，同時在前景執行不同的指令碼，例如在使用者介面中顯示進度。Web 背景工作不會封鎖使用者活動，並允許 HTML 頁面保持回應。如需 Web 背景工作的範例，請參閱 [Web 背景工作的基本概念](http://www.mdl5rocks.com/en/tutorials/workers/basics/)。如需 Internet Explorer Web 背景工作 API 的詳細資訊，請參閱 [Web 背景工作](http://msdn.microsoft.com/en-us/library/IE/hh772807%28v=vs.85%29.aspx)。
    
- 如果增益集使用需要大量 CPU 的演算法，但您可以將資料輸入或輸出分割成較小的集，請考慮建立 Web 服務，將資料傳遞至 Web 服務以卸載 CPU，並等候非同步回撥。
    
- 對您預期的最大量資料測試增益集，並將您的增益集限制在最多處理達該限制。
    

## 其他資源



- [Office 增益集的隱私權和安全性](../../docs/develop/privacy-and-security.md)
    
- [適用於 Outlook 增益集的 JavaScript API 和啟動的限制](../outlook/limits-for-activation-and-javascript-api-for-outlook-add-ins.md)
    
